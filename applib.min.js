!function(t){t.AppLib={ApiClient:class{constructor(t="",e={}){this.baseUrl=t.replace(/\/$/,""),this.defaultHeaders=e.headers||{},this.token=e.token||null,this.defaultTimeout=e.timeout||1e4}setToken(t){this.token=t}buildUrl(t){return`${this.baseUrl}/${t}`.replace(/\/+$/,"")}getDefaultHeaders(t=!1){const e={"Content-Type":"application/json",...this.defaultHeaders};return this.token&&(e.Authorization=`Bearer ${this.token}`),t&&(e["Cache-Control"]="no-cache",e.Pragma="no-cache"),e}async fetchWithTimeout(t,e={}){const{timeout:r=this.defaultTimeout}=e,i=new AbortController,s=setTimeout(()=>i.abort(),r);try{const r=await fetch(t,{...e,signal:i.signal});if(clearTimeout(s),!r.ok){let t=`Request failed with status ${r.status}`;try{const e=await r.json();t=e.message||JSON.stringify(e)}catch(t){}throw new Error(t)}return await r.json()}catch(t){if("AbortError"===t.name)throw new Error("Request timeout exceeded");throw t}}buildQueryParams(t={}){const e=new URLSearchParams(t).toString();return e?`?${e}`:""}async get(t,{params:e={},noCache:r=!1,timeout:i}={}){const s=this.buildUrl(t)+this.buildQueryParams(e);return this.fetchWithTimeout(s,{method:"GET",headers:this.getDefaultHeaders(r),timeout:i})}async post(t,e={},{noCache:r=!1,timeout:i}={}){const s=e instanceof FormData;return this.fetchWithTimeout(this.buildUrl(t),{method:"POST",headers:s?void 0:this.getDefaultHeaders(r),body:s?e:JSON.stringify(e),timeout:i})}async put(t,e={},{noCache:r=!1,timeout:i}={}){return this.fetchWithTimeout(this.buildUrl(t),{method:"PUT",headers:this.getDefaultHeaders(r),body:JSON.stringify(e),timeout:i})}async delete(t,{noCache:e=!1,timeout:r}={}){return this.fetchWithTimeout(this.buildUrl(t),{method:"DELETE",headers:this.getDefaultHeaders(e),timeout:r})}},DataTableLib:class{constructor(t={}){Object.assign(this,{api:null,rows:5,currentPage:1,tableId:"tbl-application",onRender:null,pagination:!0,searchBoxId:"",serverSide:!1,totalRows:0,loadingId:"",errorId:"",sortable:!0,paginationId:"",columnsConfig:[],searchDebounceMs:400,buildUrl:null,formatData:null},t),this.data=[],this.filteredData=[],this.sortConfig={key:null,direction:"asc"},this.baseApi=this.api,this._searchTimer=null,this._abortController=null}getArrayFromData(t){if(Array.isArray(t))return[...t];for(const e in t)if(Array.isArray(t[e]))return[...t[e]];return[]}async init(){await this.fetchData(),this._setupSearch(),this.sortable&&this.enableSorting()}_setupSearch(){if(!this.searchBoxId)return;const t=document.getElementById(this.searchBoxId);t&&t.addEventListener("input",t=>{const e=t.target.value;clearTimeout(this._searchTimer),this._searchTimer=setTimeout(()=>{this.serverSide?(this.currentPage=1,this.fetchData(1,e)):this.search(e)},this.searchDebounceMs)})}async fetchData(t=this.currentPage,e=""){this.showLoading(!0);try{this._abortController?.abort()}catch{}this._abortController=new AbortController;try{let r=this.serverSide&&"function"==typeof this.buildUrl?this.buildUrl(t,e):this.api;const i=await fetch(r,{signal:this._abortController.signal});if(!i.ok)throw new Error(`HTTP error ${i.status}`);let s=await i.json();if("function"==typeof this.formatData){const t=this.formatData(s)||[];this.data=Array.isArray(t)?t:this.getArrayFromData(t)}else this.data=this.getArrayFromData(s);this.filteredData=[...this.data],this.totalRows=this.serverSide&&s.total||this.filteredData.length,this.render()}catch(t){"AbortError"!==t.name&&this.showError(t.message)}finally{this.showLoading(!1)}}flattenValues(t){return Object.values(t).flatMap(t=>"object"==typeof t&&null!==t?this.flattenValues(t):[t])}search(t=""){const e=t.toLowerCase().trim();this.filteredData=e?this.data.filter(t=>this.flattenValues(t).some(t=>String(t??"").toLowerCase().includes(e))):[...this.data],this.currentPage=1,this.render()}enableSorting(){const t=document.getElementById(this.tableId),e=t?.querySelectorAll("thead th");e?.forEach(t=>{t.style.cursor="pointer",t.addEventListener("click",()=>{const e=t.dataset.key;this.sortConfig.direction=this.sortConfig.key===e&&"asc"===this.sortConfig.direction?"desc":"asc",this.sortConfig.key=e,this.sortData()})})}sortData(){const{key:t,direction:e}=this.sortConfig;t&&(this.filteredData.sort((r,i)=>{const s=r[t],a=i[t];return s<a?"asc"===e?-1:1:s>a?"asc"===e?1:-1:0}),this.render())}renderTableRows(){const t=document.getElementById(this.tableId),e=t?.querySelector("thead"),r=t?.querySelector("tbody");if(!r||!e)return;e.innerHTML="";const i=document.createElement("tr");this.columnsConfig.forEach(t=>{const e=document.createElement("th");e.textContent=t.label||t.field,e.dataset.key=t.field,i.appendChild(e)}),e.appendChild(i),r.innerHTML="";let s=this.filteredData,a=1;if(this.pagination)if(this.serverSide)a=Math.ceil(this.totalRows/this.rows)||1;else{a=Math.ceil(s.length/this.rows)||1;const t=(this.currentPage-1)*this.rows,e=t+this.rows;s=s.slice(t,e)}const n=document.createDocumentFragment();s.forEach(t=>{const e=document.createElement("tr");this.columnsConfig.forEach(r=>{const i=document.createElement("td");"function"==typeof r.render?i.innerHTML=r.render(t):i.textContent=t[r.field]??"",e.appendChild(i)}),n.appendChild(e)}),r.appendChild(n),this.pagination&&this.renderPagination(a),this.sortable&&this.enableSorting()}renderPagination(t){if(!this.pagination)return;this.serverSide&&(t=Math.ceil(this.totalRows/this.rows)||1);const e=this.paginationId||`pagination-${this.tableId}`;let r=document.getElementById(e);if(!r){r=document.createElement("div"),r.id=e;const t=document.getElementById(this.tableId);t?.closest(".table-responsive")?.appendChild(r)}r.innerHTML="";const i=(t,e,i=!1,s=!1)=>{const a=document.createElement("button");a.textContent=t,i&&a.classList.add("active"),s&&(a.disabled=!0),s||a.addEventListener("click",()=>{this.currentPage=e,this.serverSide?this.fetchData(e):this.renderTableRows()}),r.appendChild(a)};i("«",this.currentPage-1,!1,1===this.currentPage),this.currentPage>2&&i(1,1),this.currentPage>=3&&r.appendChild(document.createTextNode("..."));for(let e=this.currentPage-1;e<=this.currentPage+1;e++)e>0&&e<=t&&i(e,e,e===this.currentPage);this.currentPage<t-2&&r.appendChild(document.createTextNode("...")),this.currentPage<t-1&&i(t,t),i("»",this.currentPage+1,!1,this.currentPage===t)}render(){"function"==typeof this.onRender&&this.onRender(this.filteredData,this),this.renderTableRows()}reload(){this.filteredData=[...this.data],this.currentPage=1,this.render()}showLoading(t){if(!this.loadingId)return;const e=document.getElementById(this.loadingId);e&&(e.style.display=t?"block":"none")}showError(t){if(!this.errorId)return;const e=document.getElementById(this.errorId);e&&(e.textContent=t,e.style.display="block")}}}}(window);